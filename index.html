<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"acorngyl.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="spoonCat">
<meta property="og:url" content="https://acorngyl.github.io/index.html">
<meta property="og:site_name" content="spoonCat">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Acorn G">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://acorngyl.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>spoonCat</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">spoonCat</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Acorn G</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2023/07/30/ElasticSearch-DSL-Templates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/30/ElasticSearch-DSL-Templates/" class="post-title-link" itemprop="url">ElasticSearch DSL Templates</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-07-30 10:45:20 / Modified: 11:12:40" itemprop="dateCreated datePublished" datetime="2023-07-30T10:45:20+08:00">2023-07-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="常用查询"><a href="#常用查询" class="headerlink" title="#常用查询"></a><strong>#常用查询</strong></h4><h5 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="# 查看集群状态"></a><strong># 查看集群状态</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/health?v</span><br></pre></td></tr></table></figure>

<h5 id="查看节点状态"><a href="#查看节点状态" class="headerlink" title="# 查看节点状态"></a><strong># 查看节点状态</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/nodes?v</span><br></pre></td></tr></table></figure>

<h5 id="查看节点个性化参数"><a href="#查看节点个性化参数" class="headerlink" title="# 查看节点个性化参数"></a><strong># 查看节点个性化参数</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/nodeattrs?v</span><br></pre></td></tr></table></figure>

<h5 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="# 查看集群信息"></a><strong># 查看集群信息</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cluster/health</span><br></pre></td></tr></table></figure>





<h5 id="查看所有索引"><a href="#查看所有索引" class="headerlink" title="# 查看所有索引"></a><strong># 查看所有索引</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/indices?v</span><br></pre></td></tr></table></figure>

<h5 id="查看指定索引"><a href="#查看指定索引" class="headerlink" title="# 查看指定索引"></a><strong># 查看指定索引</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/shards/kibana_sample_data_flights?v</span><br></pre></td></tr></table></figure>

<h5 id="查看所有分片"><a href="#查看所有分片" class="headerlink" title="# 查看所有分片"></a><strong># 查看所有分片</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/shards?v</span><br></pre></td></tr></table></figure>

<h5 id="查看指定属性分片分配"><a href="#查看指定属性分片分配" class="headerlink" title="# 查看指定属性分片分配"></a><strong># 查看指定属性分片分配</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/shards?h=index,shard,prirep,state,unassigned.reason</span><br></pre></td></tr></table></figure>

<h5 id="可用于诊断分片未分配原因"><a href="#可用于诊断分片未分配原因" class="headerlink" title="# 可用于诊断分片未分配原因"></a><strong># 可用于诊断分片未分配原因</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cluster/allocation/explain</span><br></pre></td></tr></table></figure>



<h5 id="创建索引"><a href="#创建索引" class="headerlink" title="# 创建索引"></a><strong># 创建索引</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT hello_world</span><br></pre></td></tr></table></figure>

<h5 id="查看索引属性：aliases、mappings、settings"><a href="#查看索引属性：aliases、mappings、settings" class="headerlink" title="# 查看索引属性：aliases、mappings、settings"></a><strong># 查看索引属性：aliases、mappings、settings</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET hello_world</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/30/ElasticSearch-DSL-Templates/hello_world.png" alt="hello_world"></p>
<p><img src="/2023/07/30/ElasticSearch-DSL-Templates/hello_world_2.png" alt="hello_world_2"></p>
<h5 id="查询数据是否存在-return-200-OK"><a href="#查询数据是否存在-return-200-OK" class="headerlink" title="# 查询数据是否存在 return 200 - OK"></a><strong># 查询数据是否存在 return 200 - OK</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEAD test_target/_doc/1</span><br></pre></td></tr></table></figure>



<h5 id="随便来10条"><a href="#随便来10条" class="headerlink" title="# 随便来10条"></a><strong># 随便来10条</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br></pre></td></tr></table></figure>



<h5 id="指定查询内容"><a href="#指定查询内容" class="headerlink" title="# 指定查询内容"></a><strong># 指定查询<target>内容</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &lt;target&gt;/_search</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &lt;target&gt;/_search</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search?size=20</span><br></pre></td></tr></table></figure>



<h5 id="只查询数据"><a href="#只查询数据" class="headerlink" title="# 只查询数据"></a><strong># 只查询数据</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET test_target/_source/1</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/30/ElasticSearch-DSL-Templates/source_only.png" alt="source_only"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET _sql?format=txt</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> SELECT &quot;</span>name<span class="string">&quot;,&quot;</span>price<span class="string">&quot;,&quot;</span>lv<span class="string">&quot;,&quot;</span>type<span class="string">&quot; FROM &quot;</span>product<span class="string">&quot; where &quot;</span>price<span class="string">&quot; &gt; 999</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search?q=&quot;price&quot;&gt;999</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search?q=desc:woye2998</span><br></pre></td></tr></table></figure>



<h5 id="插入一条新记录-x2F-或修改条记录"><a href="#插入一条新记录-x2F-或修改条记录" class="headerlink" title="# 插入一条新记录&#x2F;或修改条记录"></a><strong># 插入一条新记录&#x2F;或修改条记录</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT hello_world/_doc/&lt;_id&gt;</span><br></pre></td></tr></table></figure>

<h5 id="插入一条新记录"><a href="#插入一条新记录" class="headerlink" title="# 插入一条新记录"></a><strong># 插入一条新记录</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST hello_world/_doc/</span><br></pre></td></tr></table></figure>

<h5 id="修改一条记录"><a href="#修改一条记录" class="headerlink" title="# 修改一条记录"></a><strong># 修改一条记录</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST hello_world/_doc/&lt;_id&gt;</span><br></pre></td></tr></table></figure>

<h5 id="指定id创建一条"><a href="#指定id创建一条" class="headerlink" title="# 指定id创建一条"></a><strong># 指定id创建一条</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT hello_world/_create/&lt;_id&gt;</span><br></pre></td></tr></table></figure>

<h5 id="指定id创建一条-1"><a href="#指定id创建一条-1" class="headerlink" title="# 指定id创建一条"></a><strong># 指定id创建一条</strong></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST hello_world/_create/&lt;_id&gt;</span><br></pre></td></tr></table></figure>





<h5 id="create-and-update"><a href="#create-and-update" class="headerlink" title="# create and update"></a><strong># create and update</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT test_target/_doc/<span class="number">1</span>?op_type=index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;10field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">2123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST test_target/_doc/<span class="number">2</span>?op_type=index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;10field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">2123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="create-only"><a href="#create-only" class="headerlink" title="# create only"></a><strong># create only</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT test_target/_doc/<span class="number">1</span>?op_type=create</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;10field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">2123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST test_target/_doc/<span class="number">2</span>?op_type=create</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;10field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">2123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="指定插入一条记录"><a href="#指定插入一条记录" class="headerlink" title="# 指定插入一条记录"></a><strong># 指定插入一条记录</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT hello_world/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="插入一条新记录-1"><a href="#插入一条新记录-1" class="headerlink" title="# 插入一条新记录"></a><strong># 插入一条新记录</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST hello_world/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;field_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;2field123456&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_2&quot;</span><span class="punctuation">:</span><span class="number">2123456</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;field_3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-01-30T10:02:07Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="日期类型"><a href="#日期类型" class="headerlink" title="# 日期类型"></a><strong># 日期类型</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT test_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="nested"><a href="#nested" class="headerlink" title="# nested"></a><strong># nested</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据</span></span><br><span class="line">DELETE order</span><br><span class="line"></span><br><span class="line">PUT order</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;goods_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nested&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /order/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;order_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi order&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shouji zhong de zhandouji&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;goods_count&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;total_price&quot;</span><span class="punctuation">:</span> <span class="number">12699</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;goods_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi PRO MAX 5G&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">1999</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ganghuamo&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">19</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shoujike&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">1999</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT /order/_doc/<span class="number">2</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;order_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cleaning robot order&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shouji zhong de zhandouji&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;goods_count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;total_price&quot;</span><span class="punctuation">:</span> <span class="number">12699</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;goods_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi cleaning robot order&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">1999</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dishwasher&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">4999</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET /order/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;nested&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;goods_list&quot;</span><span class="punctuation">,</span> </span><br><span class="line">   <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​      <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​        <span class="attr">&quot;goods_list.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dishwasher&quot;</span></span><br><span class="line">​       <span class="punctuation">&#125;</span></span><br><span class="line">​      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​        <span class="attr">&quot;goods_list.price&quot;</span><span class="punctuation">:</span> <span class="number">1999</span></span><br><span class="line">​       <span class="punctuation">&#125;</span></span><br><span class="line">​      <span class="punctuation">&#125;</span></span><br><span class="line">​     <span class="punctuation">]</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="analyzer"><a href="#analyzer" class="headerlink" title="# analyzer"></a><strong># analyzer</strong></h4><p><strong># 分析工具</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line"></span><br><span class="line">GET &lt;index&gt;/_analyze</span><br><span class="line"></span><br><span class="line">POST &lt;index&gt;/_analyze</span><br></pre></td></tr></table></figure>





<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;english&quot;</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;What is are you doing&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET my_index/_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_analyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;p&gt;I&#x27;m so &lt;a&gt;happy&lt;/a&gt;!&lt;/p&gt;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="char-filter"><a href="#char-filter" class="headerlink" title="# char_filter"></a><strong># char_filter</strong></h5><ul>
<li>pattern_replace</li>
<li>mapping</li>
<li>html_strip</li>
</ul>
<h5 id="filter"><a href="#filter" class="headerlink" title="# filter"></a><strong># filter</strong></h5><ul>
<li>Lowcase</li>
<li>Uppercase</li>
<li>Trim</li>
<li>Synonym ★</li>
<li>Stop</li>
</ul>
<h5 id="tokenizer"><a href="#tokenizer" class="headerlink" title="# tokenizer"></a><strong># tokenizer</strong></h5><ul>
<li>whitespace ★</li>
<li>english</li>
<li>standard</li>
</ul>
<h5 id="自定义分词器"><a href="#自定义分词器" class="headerlink" title="# 自定义分词器"></a><strong># 自定义分词器</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">PUT /test_analysis</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// char_filter 字符转化**</span></span><br><span class="line">   <span class="attr">&quot;char_filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;test_char_filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mapping&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​      <span class="string">&quot;&amp; =&gt; and&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="string">&quot;| =&gt; or&quot;</span></span><br><span class="line">​     <span class="punctuation">]</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter 过滤</span></span><br><span class="line">   <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;test_stopwords&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stop&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;stopwords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;is&quot;</span><span class="punctuation">,</span><span class="string">&quot;in&quot;</span><span class="punctuation">,</span><span class="string">&quot;at&quot;</span><span class="punctuation">,</span><span class="string">&quot;the&quot;</span><span class="punctuation">,</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span><span class="string">&quot;for&quot;</span><span class="punctuation">]</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tokenizer 切词</span></span><br><span class="line">   <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;punctuation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pattern&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[ .,!?]&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// analyzer 自定义</span></span><br><span class="line">   <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;my_analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;char_filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​      <span class="string">&quot;html_strip&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="string">&quot;test_char_filter&quot;</span></span><br><span class="line">​     <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lowercase&quot;</span><span class="punctuation">,</span><span class="string">&quot;test_stopwords&quot;</span><span class="punctuation">]</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="远程集群"><a href="#远程集群" class="headerlink" title="# 远程集群"></a><strong># 远程集群</strong></h4><p><strong># 远程集群和本地集群都要有remote_cluster_client角色</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cluster&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;remote&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;local_cluster&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;skip_unavailable&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sniff&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;proxy_address&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;proxy_socket_connections&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;server_name&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;seeds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​      <span class="string">&quot;192.168.50.202:9300&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="string">&quot;192.168.50.203:9300&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="string">&quot;192.168.50.222:9300&quot;</span></span><br><span class="line">​     <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;node_connections&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET /ccs_cluster<span class="punctuation">:</span>ccs_index<span class="punctuation">,</span>local_cluster<span class="punctuation">:</span>ccs_index/_search</span><br></pre></td></tr></table></figure>



<h4 id="跨集群复制"><a href="#跨集群复制" class="headerlink" title="# 跨集群复制"></a># 跨集群复制</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT /cs_index/_ccr/follow</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;remote_cluster&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster2&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;leader_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ccs_index&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_read_request_operation_count&quot;</span><span class="punctuation">:</span> <span class="number">5120</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_outstanding_read_requests&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_read_request_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32mb&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_write_request_operation_count&quot;</span><span class="punctuation">:</span> <span class="number">5120</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_write_request_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9223372036854775807b&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_outstanding_write_requests&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_write_buffer_count&quot;</span><span class="punctuation">:</span> <span class="number">2147483647</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_write_buffer_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512mb&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;max_retry_delay&quot;</span><span class="punctuation">:</span> <span class="string">&quot;500ms&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;read_poll_timeout&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1m&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="security"><a href="#security" class="headerlink" title="# security"></a><strong># security</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-certutil ca</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scp </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config/</span><br><span class="line"></span><br><span class="line">xpack.security.enabled: true</span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate </span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl.client_authentication: required</span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl.keystore.path: elastic-certificates.p12</span><br><span class="line"></span><br><span class="line">xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./bin/elasticsearch-reset-password -u user1 -i</span><br></pre></td></tr></table></figure>



<p><img src="/2023/07/30/ElasticSearch-DSL-Templates/kibana_security.png" alt="kibana_security"></p>
<h4 id="RBCA"><a href="#RBCA" class="headerlink" title="# RBCA"></a><strong># RBCA</strong></h4><h4 id="快照"><a href="#快照" class="headerlink" title="# 快照"></a><strong># 快照</strong></h4><p>path.repo: [“~&#x2F;es&#x2F;backup”] &#x2F;&#x2F; 配置文件</p>
<h5 id="仓库名称"><a href="#仓库名称" class="headerlink" title="# 仓库名称"></a><strong># 仓库名称</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /_snapshot/my_backup </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fs&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~/es/backup&quot;</span> <span class="comment">// 多节点要使用共享目录</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="backup"><a href="#backup" class="headerlink" title="# backup"></a># backup</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/my_backup/snapshot_1?wait_for_completion=<span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kibana_sample_data_flights,kibana_sample_data_logs&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="restore-with-origin-name"><a href="#restore-with-origin-name" class="headerlink" title="# restore with origin name"></a># restore with origin name</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /_snapshot/my_backup/snapshot_1/_restore?wait_for_completion=<span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kibana_sample_data_flights&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="restore-and-rename"><a href="#restore-and-rename" class="headerlink" title="# restore and rename"></a># restore and rename</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /_snapshot/my_backup/snapshot_1/_restore?wait_for_completion=<span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kibana_sample_data_logs&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;ignore_unavailable&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;include_global_state&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;rename_pattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kibana_sample_(.+)&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;rename_replacement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;restored_index_$1&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;include_aliases&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;snapshot&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;snapshot&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;snapshot_1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="string">&quot;restored_index_data_logs&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="reachable-snapshot-backup-before"><a href="#reachable-snapshot-backup-before" class="headerlink" title="# reachable snapshot, backup before"></a><strong># reachable snapshot, backup before</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST _snapshot/my_backup/snapshot_2/_mount?wait_for_completion=<span class="keyword">true</span> </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster2_index1&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;renamed_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster2_index1_bak&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;index_settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index.number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="SLM"><a href="#SLM" class="headerlink" title="# SLM"></a><strong># SLM</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT _slm/policy/nightly-snapshots</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;schedule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0 50 * * * ?&quot;</span><span class="punctuation">,</span>    </span><br><span class="line"> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;nightly-snap-&#123;now/h&#125;&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;repository&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_backup&quot;</span><span class="punctuation">,</span>   </span><br><span class="line"> <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster2_index1,ccs_index&quot;</span><span class="punctuation">,</span>   </span><br><span class="line">  <span class="attr">&quot;include_global_state&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span>   </span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;retention&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>           </span><br><span class="line">  <span class="attr">&quot;expire_after&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20h&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;min_count&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;max_count&quot;</span><span class="punctuation">:</span> <span class="number">50</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="alias"><a href="#alias" class="headerlink" title="### alias"></a><strong>### alias</strong></h4><h5 id="通过别名过滤"><a href="#通过别名过滤" class="headerlink" title="# 通过别名过滤"></a><strong># 通过别名过滤</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT /test</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alias_1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;alias_2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;user.id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kimchy&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># 过滤结果，只能查到下边内容</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">     <span class="attr">&quot;user.id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot; kimchy&quot;</span></span><br><span class="line"></span><br><span class="line">and</span><br><span class="line"></span><br><span class="line">​     <span class="attr">&quot;user&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;kimchy&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="给索引添加别名"><a href="#给索引添加别名" class="headerlink" title="# 给索引添加别名"></a><strong># 给索引添加别名</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST _aliases</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product_template&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product_template_01&quot;</span> <span class="comment">// 一个所有多个别名</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="多个索引，一个别名"><a href="#多个索引，一个别名" class="headerlink" title="# 多个索引，一个别名"></a><strong># 多个索引，一个别名</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product_real2&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product2&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="string">&quot;product_real2&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="别名的CRUD"><a href="#别名的CRUD" class="headerlink" title="# 别名的CRUD"></a><strong># 别名的CRUD</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;actions&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;remove&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;product&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alias&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;product_template&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;add&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;product&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alias&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;product_real&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// route_length_miles是字段distance的别名</span></span><br><span class="line"></span><br><span class="line">PUT trips</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;route_length_miles&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alias&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;distance&quot;</span> </span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;transit_mode&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET _search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;range&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;route_length_miles&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;gte&quot;</span> <span class="punctuation">:</span> <span class="number">39</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="滚动索引ILM"><a href="#滚动索引ILM" class="headerlink" title="# 滚动索引ILM"></a><strong># 滚动索引ILM</strong></h4><h5 id="设置ILM刷新周期"><a href="#设置ILM刷新周期" class="headerlink" title="# 设置ILM刷新周期"></a><strong># 设置ILM刷新周期</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;indices.lifecycle.poll_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST logs_write/_refresh</span><br></pre></td></tr></table></figure>



<p><strong># 创建ILM（可通过kibana操作，包含冷热节点、rollover）</strong></p>
<p><strong># （只用ILM的话，只有hot配置“data_content”。因为ILM情况下，数据优先分配给“data_content”，无视hot）</strong></p>
<p><strong># 创建索引模版，引用ILM</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT _index_template/my_template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;test_ilm_index_*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;index.lifecycle.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_ilm&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="# 创建索引"></a><strong># 创建索引</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT _index_template/my_template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;test_ilm_index_*&quot;</span></span><br><span class="line"> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;index.lifecycle.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_ilm_p&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;index.routing.allocation.require.hot_warm_cold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hot&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;english&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="rollover"><a href="#rollover" class="headerlink" title="# rollover"></a># rollover</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_logs<span class="number">-000001</span> </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;english&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;logs_write&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># 对别名插入数据</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT logs_write/_bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;test data 1&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;test data 2&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># 刷新索引</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;indices.lifecycle.poll_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST logs_write/_refresh</span><br></pre></td></tr></table></figure>



<p><strong># 执行滚动。如果使用了ILM，怎么用索引？</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST logs_write/_rollover</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;conditions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;max_age&quot;</span><span class="punctuation">:</span>  <span class="string">&quot;7d&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;max_docs&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;max_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5gb&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="滚动后，别名指向新索引"><a href="#滚动后，别名指向新索引" class="headerlink" title="# 滚动后，别名指向新索引"></a># 滚动后，别名指向新索引</h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE _index_template/template_1</span><br><span class="line"></span><br><span class="line">// 如果ILM不用rollover，就没办法变更别名</span><br><span class="line"></span><br><span class="line">// 数据流没用别名</span><br></pre></td></tr></table></figure>



<h4 id="冷热节点"><a href="#冷热节点" class="headerlink" title="# 冷热节点"></a><strong># 冷热节点</strong></h4><p><strong># 开启集群感知策略</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;transient&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cluster.routing.allocation.awareness.attributes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hot_warm_cold&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># 创建索引，或者修改setting</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT index_a</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index.routing.allocation.include.hot_warm_cold&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;hot&quot;</span><span class="punctuation">,</span><span class="string">&quot;warm&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index.routing.allocation.require.hot_warm_cold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warm&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT index_a/_settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;index.routing.allocation.require.hot_warm_cold&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cold&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.1/modules-node.html#data-node">https://www.elastic.co/guide/en/elasticsearch/reference/8.1/modules-node.html#data-node</a></p>
<p>[Node | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.1/modules-node.html#data-node">8.1] | Elastic</a></p>
<p># Data_naode : you use specialized data roles to assign data nodes to specific tiers: data_content,data_hot, data_warm, data_cold, or data_frozen. A node can belong to multiple tiers, but a node that has one of the specialized data roles cannot have the generic data role.</p>
<p># Data_content : generally stores a collection of items such as a product catalog or article archive.System indices and other indices that aren’t part of a data stream are automatically allocated to the content tier.</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.1/ilm-allocate.html">https://www.elastic.co/guide/en/elasticsearch/reference/8.1/ilm-allocate.html</a></p>
<p>[Allocate | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.1/ilm-allocate.html">8.1] | Elastic</a></p>
<p># Phases allowed: warm, cold.</p>
<p># Updates the index settings to change which nodes are allowed to host the index shards and change the number of replicas.</p>
<p># The allocate action is not allowed in the hot phase. The initial allocation for the index must be done manually or via <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.1/index-templates.html">index templates</a>.</p>
<p><strong># settings</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// include **和** require同级，互相影响</span></span><br><span class="line"><span class="comment">// data角色包含data_content、data_hot、data_warm、data_cold，不能同时配置。</span></span><br><span class="line"><span class="comment">// ILM用data_content(data_hot节点用，hot可以不配置)、data_warm、data_cold。</span></span><br><span class="line"><span class="comment">// include默认&quot;_tier_preference&quot; : &quot;data_content&quot;, 数据默认分配给的角色。include如果配置其他角色，各个角色节点随机分配</span></span><br><span class="line"><span class="comment">// require 指定一个，且shards必须分配到中</span></span><br><span class="line"><span class="comment">// include和require冲突时，如果新建会超时；如果会改setting，不变更分配</span></span><br><span class="line"><span class="comment">// include和require千万别冲突，不然影响ILM流转。</span></span><br><span class="line"><span class="comment">// ILM的index模版用require</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index_a&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;routing&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;allocation&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;include&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;_tier_preference&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;data_content&quot;</span><span class="punctuation">,</span></span><br><span class="line">​       <span class="attr">&quot;hot_warm_cold&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​        <span class="string">&quot;hot&quot;</span><span class="punctuation">,</span></span><br><span class="line">​        <span class="string">&quot;warm&quot;</span></span><br><span class="line">​       <span class="punctuation">]</span></span><br><span class="line">​      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="attr">&quot;require&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;hot_warm_cold&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;cold&quot;</span></span><br><span class="line">​      <span class="punctuation">&#125;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;number_of_shards&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;provided_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;index_a&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;creation_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1688354134229&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;number_of_replicas&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;YnhMJljHSFi8WiQM7ql6Eg&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;created&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8010099&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="Script"><a href="#Script" class="headerlink" title="# Script"></a><strong># Script</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">PUT _scripts/my-search-template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mustache&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;query_gte&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;query_lt&#125;&#125;&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;from&#125;&#125;&#123;&#123;^from&#125;&#125;0&#123;&#123;/from&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;size&#125;&#125;&#123;&#123;^size&#125;&#125;5&#123;&#123;/size&#125;&#125;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET product/_search/template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-search-template&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query_gte&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;query_lt&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="Templates"><a href="#Templates" class="headerlink" title="# Templates"></a><strong># Templates</strong></h4><h5 id="Search-Template-Script-Template"><a href="#Search-Template-Script-Template" class="headerlink" title="# Search Template(Script Template)"></a><strong># Search Template(Script Template)</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">PUT _scripts/my-search-template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mustache&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;query_gte&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;query_lt&#125;&#125;&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;from&#125;&#125;&#123;&#123;^from&#125;&#125;0&#123;&#123;/from&#125;&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;size&#125;&#125;&#123;&#123;^size&#125;&#125;5&#123;&#123;/size&#125;&#125;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET product/_search/template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-search-template&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query_gte&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;query_lt&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看</span></span><br><span class="line"></span><br><span class="line">GET _scripts/calculate_discount</span><br><span class="line"></span><br><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;script_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;painless&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;doc[&#x27;price&#x27;].value&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;discount_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;calculate_discount&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;discount&quot;</span><span class="punctuation">:</span> <span class="number">0.8</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="mapping-template"><a href="#mapping-template" class="headerlink" title="# mapping template"></a><strong># mapping template</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">PUT my-index<span class="number">-000001</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dynamic_templates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;long_as_integer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;long_as_strings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long_*&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;unmatch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*_text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;full_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;path_match&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name.*&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;path_unmatch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*.middle&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;full_name&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT my-index<span class="number">-000001</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dynamic_templates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@timestamp&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">​      <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="Dynamic-Mapping-Template"><a href="#Dynamic-Mapping-Template" class="headerlink" title="# Dynamic Mapping Template"></a><strong># Dynamic Mapping Template</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PUT my_template_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dynamic_templates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;long_as_integer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;long_as_strings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long_*&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;unmatch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*_text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="Index-Template-Component-Template"><a href="#Index-Template-Component-Template" class="headerlink" title="# Index Template(Component Template)"></a><strong># Index Template(Component Template)</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT _index_template/my_index_template</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index_patterns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;index_*&quot;</span></span><br><span class="line"> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;english&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>







<h4 id="query"><a href="#query" class="headerlink" title="# query"></a><strong># query</strong></h4><h5 id="match-match-all-match-phrase"><a href="#match-match-all-match-phrase" class="headerlink" title="# match, match_all, match_phrase"></a><strong># match, match_all, match_phrase</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hongmi erji&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># term的查询词部分词，所以只能匹配keyword字段</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hongmi erji&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hongmi erji&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="boolean-query"><a href="#boolean-query" class="headerlink" title="# boolean query"></a><strong># boolean query</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # must = filter</span></span><br><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi phone&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shouji zhong&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="should"><a href="#should" class="headerlink" title="# should"></a><strong># should</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">​      <span class="punctuation">&#125;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nfc&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;minimum_should_match&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="must-not"><a href="#must-not" class="headerlink" title="# must_not"></a><strong># must_not</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line"></span><br><span class="line"><span class="comment">// must_not和filter没有评分</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;minimum_should_match&quot;: 0 should和其他条件一起使用时，默认是0，可以一条也不符合</span></span><br></pre></td></tr></table></figure>





<h5 id="boost"><a href="#boost" class="headerlink" title="# boost"></a><strong># boost</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xiaomi&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shouji phone&quot;</span></span><br><span class="line">​      <span class="punctuation">&#125;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">​    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​       <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span></span><br><span class="line">​       <span class="punctuation">&#125;</span></span><br><span class="line">​      <span class="punctuation">&#125;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">​     <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;multiply&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="multi-match"><a href="#multi-match" class="headerlink" title="# multi_match"></a><strong># multi_match</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;multi_match&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;hongmi erji&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>    <span class="string">&quot;best_fields&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>   <span class="punctuation">[</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="string">&quot;desc&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;tie_breaker&quot;</span><span class="punctuation">:</span> <span class="number">0.3</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tie_breaker只作用于best fields</span></span><br></pre></td></tr></table></figure>





<h5 id="AGGS"><a href="#AGGS" class="headerlink" title="# AGGS"></a><strong># AGGS</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;&lt;AGG_NAME&gt;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;&lt;AGG_TYPE&gt;&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&lt;FIELD_NAME&gt;&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># term &#x3D; group by</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tags.keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;_count&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># 可以嵌套query，从query的结果聚合.先query后aggs,和先后没关系</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">3000</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tags.keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;_count&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="metrics-agg"><a href="#metrics-agg" class="headerlink" title="# metrics agg"></a><strong># metrics agg</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name_stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name_min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name_max&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name_avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name_sum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;sum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="nested-agg"><a href="#nested-agg" class="headerlink" title="# nested agg"></a><strong># nested agg</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name_main_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name.keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;name_sub_agg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;name_sub_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;sum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># input ： buckets or metrics</strong></p>
<p><strong>## 例：统计平均价格最低的商品分类</strong></p>
<p><strong># 商品分类</strong></p>
<p><strong># 统计平均价格</strong></p>
<p><strong># 最低的分类</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name_term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;createtime&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;name_avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​     <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​      <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">​     <span class="punctuation">&#125;</span></span><br><span class="line">​    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name_pipline_agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;min_bucket&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;buckets_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name_term&gt;name_avg&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="pipline"><a href="#pipline" class="headerlink" title="# pipline"></a><strong># pipline</strong></h4><h5 id="reindex-pipline"><a href="#reindex-pipline" class="headerlink" title="# reindex + pipline"></a><strong># reindex + pipline</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/name_pipeline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;processors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;trim&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tags&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index_pipeline&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index_pipeline_new&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name_pipeline&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h5 id="update-by-query-pipline"><a href="#update-by-query-pipline" class="headerlink" title="# update by query + pipline"></a><strong># update by query + pipline</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/name_task2_pipeline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;processors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;set&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;newadd.subnew&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&#123;&#123;value01&#125;&#125;&#125;.&#123;&#123;&#123;value02&#125;&#125;&#125;.&#123;&#123;&#123;value03&#125;&#125;&#125;.&#123;&#123;&#123;value04&#125;&#125;&#125;&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST task2_bak/_update_by_query?pipeline=name_task2_pipeline</span><br></pre></td></tr></table></figure>



<h5 id="update-by-query-pipline-1"><a href="#update-by-query-pipline-1" class="headerlink" title="# update by query + pipline"></a><strong># update by query + pipline</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/earthquakes_pipeline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;processors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;uppercase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;area&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;painless&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">​    if(ctx.containsKey(&quot;</span>batch_number<span class="string">&quot;)==true)&#123;</span></span><br><span class="line"><span class="string">​     ctx.batch_number += 1;</span></span><br><span class="line"><span class="string">​    &#125;else&#123;</span></span><br><span class="line"><span class="string">​     ctx.batch_number = 1;</span></span><br><span class="line"><span class="string">​    &#125;</span></span><br><span class="line"><span class="string">​     &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST earthquakes_bak/_update_by_query?pipeline=earthquakes_pipeline</span><br></pre></td></tr></table></figure>



<h5 id="reindex"><a href="#reindex" class="headerlink" title="# reindex"></a><strong># reindex</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index_pipeline&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index_pipeline_new&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name_pipeline&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="enrich-pipline"><a href="#enrich-pipline" class="headerlink" title="# enrich pipline"></a><strong># enrich pipline</strong></h4><h5 id="source-index"><a href="#source-index" class="headerlink" title="# source index"></a><strong># source index</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PUT /pei_liao/_doc/<span class="number">1</span>?refresh=wait_for</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;菜品&quot;</span><span class="punctuation">:</span> <span class="string">&quot;干锅花菜&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;调料&quot;</span><span class="punctuation">:</span> <span class="string">&quot;食盐&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配菜&quot;</span><span class="punctuation">:</span> <span class="string">&quot;山东大葱&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;辅料&quot;</span><span class="punctuation">:</span> <span class="string">&quot;酱油&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料a&quot;</span><span class="punctuation">:</span> <span class="string">&quot;八角&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料b&quot;</span><span class="punctuation">:</span> <span class="string">&quot;桂皮&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料c&quot;</span><span class="punctuation">:</span> <span class="string">&quot;香叶&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /pei_liao/_doc/<span class="number">2</span>?refresh=wait_for</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;菜品&quot;</span><span class="punctuation">:</span> <span class="string">&quot;醋溜肥肠&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;调料&quot;</span><span class="punctuation">:</span> <span class="string">&quot;食盐&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配菜&quot;</span><span class="punctuation">:</span> <span class="string">&quot;洋葱&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;辅料&quot;</span><span class="punctuation">:</span> <span class="string">&quot;82年陈醋&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料a&quot;</span><span class="punctuation">:</span> <span class="string">&quot;八角&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料b&quot;</span><span class="punctuation">:</span> <span class="string">&quot;桂皮&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;配料c&quot;</span><span class="punctuation">:</span> <span class="string">&quot;香叶&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h5 id="enrich-policy"><a href="#enrich-policy" class="headerlink" title="# enrich policy"></a><strong># enrich policy</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT _enrich/policy/caipu_policy</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pei_liao&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;match_field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;菜品&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;enrich_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;调料&quot;</span><span class="punctuation">,</span> <span class="string">&quot;配菜&quot;</span><span class="punctuation">,</span> <span class="string">&quot;辅料&quot;</span><span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<p><strong># execute policy</strong></p>
<p><strong># An *enrich index* well be created and always begin with .enrich-</strong></p>
<p><strong># It is read-only. If update your source indices, you should execute the enrich policy again.</strong></p>
<p><strong># A new index well be created. The previous index well be deleted after 15 minutes.</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /_enrich/policy/caipu_policy/_execute</span><br><span class="line"></span><br><span class="line">GET /_enrich/policy/&lt;policy_name&gt;</span><br><span class="line"></span><br><span class="line">DELETE /_enrich/policy/&lt;policy_name&gt;</span><br><span class="line"></span><br><span class="line">GET /_enrich/_stats</span><br></pre></td></tr></table></figure>



<p><strong># create a pipline use enrich policy</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/zuoliacai_pipline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;processors&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;enrich&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">​    <span class="attr">&quot;policy_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;caipu_policy&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;菜品&quot;</span><span class="punctuation">,</span></span><br><span class="line">​    <span class="attr">&quot;target_field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本菜品包含的配料&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong># input doc</strong> </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT /lanch_index/_doc/<span class="number">1</span>?pipeline=zuoliacai_pipline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;主食材&quot;</span><span class="punctuation">:</span> <span class="string">&quot;花菜&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;菜品&quot;</span><span class="punctuation">:</span> <span class="string">&quot;干锅花菜&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /lanch_index/_doc/<span class="number">2</span>?pipeline=zuoliacai_pipline</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;主食材&quot;</span><span class="punctuation">:</span> <span class="string">&quot;肥肠&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;菜品&quot;</span><span class="punctuation">:</span> <span class="string">&quot;醋溜肥肠&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2023/03/29/NetherlandsFlag/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/29/NetherlandsFlag/" class="post-title-link" itemprop="url">NetherlandsFlag</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-29 23:08:28 / Modified: 23:10:15" itemprop="dateCreated datePublished" datetime="2023-03-29T23:08:28+08:00">2023-03-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetherlandsFlag</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] netherlandsFlag(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R) &#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt; R) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;-<span class="number">1</span>, -<span class="number">1</span>&#125;;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (L == R) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; L, R&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">less</span> <span class="operator">=</span> L - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">more</span> <span class="operator">=</span> R;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> L;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; more) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[index] == arr[R]) &#123;</span><br><span class="line">                index++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[index] &lt; arr[R]) &#123;</span><br><span class="line"><span class="comment">//				swap(arr, less + 1, index);</span></span><br><span class="line"><span class="comment">//				index++;						</span></span><br><span class="line">				swap(arr, index++, ++less);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                swap(arr, index, --more);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(arr, more, R); <span class="comment">// &lt;[R]   =[R]   &gt;[R]</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; less + <span class="number">1</span>, more &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (arr.length &lt; <span class="number">60</span>) &#123;</span><br><span class="line">            insertionSort(arr);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        process(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt;= R) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(arr, L + (<span class="type">int</span>) ((R - L + <span class="number">1</span>) * Math.random()), R);</span><br><span class="line">        <span class="type">int</span>[] equalArea = netherlandsFlag(arr, L, R);</span><br><span class="line">        process(arr, L, equalArea[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">        process(arr, equalArea[<span class="number">1</span>] + <span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[i] = arr[i] ^ arr[j];</span><br><span class="line">        arr[j] = arr[i] ^ arr[j];</span><br><span class="line">        arr[i] = arr[i] ^ arr[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertionSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i++) &#123; </span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; arr[j + <span class="number">1</span>]; j--) &#123;</span><br><span class="line">				swap(arr, j, j + <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2023/03/28/SimpleSort/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/28/SimpleSort/" class="post-title-link" itemprop="url">SimpleSort</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-28 08:49:22 / Modified: 08:51:23" itemprop="dateCreated datePublished" datetime="2023-03-28T08:49:22+08:00">2023-03-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleSort</span> &#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectionSort</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; n; j++)&#123;</span><br><span class="line">                minIndex = arr[j] &lt; arr[minIndex] ? j : minIndex;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(arr, i, minIndex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">R</span> <span class="operator">=</span> arr.length - <span class="number">1</span>; R &gt; <span class="number">0</span>; R--)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; R; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                    swap(arr, i, i + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertionSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 不只1个数</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i++) &#123; <span class="comment">// 0 ~ i 做到有序</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; arr[j + <span class="number">1</span>]; j--) &#123;</span><br><span class="line">				swap(arr, j, j + <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[i] = arr[i] ^ arr[j];</span><br><span class="line">        arr[j] = arr[i] ^ arr[j];</span><br><span class="line">        arr[i] = arr[i] ^ arr[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 1. f(arr,L, R)</span></span><br><span class="line"><span class="comment">     * 2. f(arr, L, Mid)</span></span><br><span class="line"><span class="comment">     * 3. f(arr, Mid+1, R)</span></span><br><span class="line"><span class="comment">     * 4. merge &#123; </span></span><br><span class="line"><span class="comment">     * int[] help = int[R - L +1], i = 0, pL = L, pR = Mid + 1</span></span><br><span class="line"><span class="comment">     * if (pL &lt;= Mid &amp;&amp; pR &lt;= R) help[i++] = pL &lt;= pR ? pL++ : pR++ </span></span><br><span class="line"><span class="comment">	 * // 两数相等，先拷贝左边内容，这里先拷贝右组会破坏稳定性</span></span><br><span class="line"><span class="comment">     * arr[L + i] = help[i] &#125;</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> arr</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// 递归方法实现</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort1</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		process(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请把arr[L..R]排有序</span></span><br><span class="line">	<span class="comment">// l...r N</span></span><br><span class="line">	<span class="comment">// T(N) = 2 * T(N / 2) + O(N)</span></span><br><span class="line">	<span class="comment">// O(N * logN)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (L == R) &#123; <span class="comment">// base case</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> L + ((R - L) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">		process(arr, L, mid);</span><br><span class="line">		process(arr, mid + <span class="number">1</span>, R);</span><br><span class="line">		merge(arr, L, mid, R);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> M, <span class="type">int</span> R)</span> &#123;</span><br><span class="line">		<span class="type">int</span>[] help = <span class="keyword">new</span> <span class="title class_">int</span>[R - L + <span class="number">1</span>];</span><br><span class="line">		<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> L;</span><br><span class="line">		<span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> M + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (p1 &lt;= M &amp;&amp; p2 &lt;= R) &#123;</span><br><span class="line">			help[i++] = arr[p1] &lt;= arr[p2] ? arr[p1++] : arr[p2++];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 要么p1越界了，要么p2越界了</span></span><br><span class="line">		<span class="keyword">while</span> (p1 &lt;= M) &#123;</span><br><span class="line">			help[i++] = arr[p1++];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (p2 &lt;= R) &#123;</span><br><span class="line">			help[i++] = arr[p2++];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; help.length; i++) &#123;</span><br><span class="line">			arr[L + i] = help[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * int mergeSize = 1, </span></span><br><span class="line"><span class="comment">	 * int N = arr.lenght, </span></span><br><span class="line"><span class="comment">	 * pL = 0, pLeftLast = pL + mergeSize - 1, </span></span><br><span class="line"><span class="comment">	 * pR = pLeftLast + 1, pRightLast = pR + mergeSize - 1</span></span><br><span class="line"><span class="comment">	 * L = pL, M = pLeftLast, R = min(pRightLast, N - 1)</span></span><br><span class="line"><span class="comment">	 * merge(arr, L, M, R)</span></span><br><span class="line"><span class="comment">	 * while mergeSize &lt; N &#123;</span></span><br><span class="line"><span class="comment">	 * if pLeftLast &gt;= N break</span></span><br><span class="line"><span class="comment">	 * merge()</span></span><br><span class="line"><span class="comment">	 * if mergeSize &gt; n/2 break</span></span><br><span class="line"><span class="comment">	 * mergeSize &lt;&lt; 1&#125;</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> arr</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// 非递归方法实现</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort2</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> arr.length;</span><br><span class="line">		<span class="comment">// 步长</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">mergeSize</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (mergeSize &lt; N) &#123; <span class="comment">// log N</span></span><br><span class="line">			<span class="comment">// 当前左组的，第一个位置</span></span><br><span class="line">			<span class="type">int</span> <span class="variable">L</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span> (L &lt; N) &#123;</span><br><span class="line">				<span class="keyword">if</span> (mergeSize &gt;= N - L) &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="type">int</span> <span class="variable">M</span> <span class="operator">=</span> L + mergeSize - <span class="number">1</span>;</span><br><span class="line">				<span class="type">int</span> <span class="variable">R</span> <span class="operator">=</span> M + Math.min(mergeSize, N - M - <span class="number">1</span>);</span><br><span class="line">				merge(arr, L, M, R);</span><br><span class="line">				L = R + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 防止溢出</span></span><br><span class="line">			<span class="keyword">if</span> (mergeSize &gt; N / <span class="number">2</span>) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			mergeSize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2023/03/28/Generating-Random-Strings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/28/Generating-Random-Strings/" class="post-title-link" itemprop="url">Generating Random Strings</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-28 08:44:29 / Modified: 08:46:37" itemprop="dateCreated datePublished" datetime="2023-03-28T08:44:29+08:00">2023-03-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomCode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">times</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">num</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">chr</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">cchr</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> times; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">StringBuffer</span> <span class="variable">code</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> len; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">touch</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">while</span>(!touch) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> (<span class="type">int</span>) ((<span class="number">3</span> + <span class="number">1</span>) * Math.random());</span><br><span class="line">                    <span class="keyword">if</span> (type == <span class="number">1</span> &amp;&amp; sb) &#123;</span><br><span class="line">                        code.append(rSb());</span><br><span class="line">                        touch = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">2</span> &amp;&amp; chr) &#123;</span><br><span class="line">                        code.append(rChr());</span><br><span class="line">                        touch = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">3</span> &amp;&amp; cchr) &#123;</span><br><span class="line">                        code.append(rCChr());</span><br><span class="line">                        touch = <span class="literal">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">0</span> &amp;&amp; num) &#123;</span><br><span class="line">                        code.append(rNum());</span><br><span class="line">                        touch = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(code.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">rNum</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;0123456789&quot;</span>;</span><br><span class="line">        <span class="type">char</span> nums[] = str.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">site</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">        <span class="type">char</span> <span class="variable">chr</span> <span class="operator">=</span> nums[(<span class="type">int</span>) ((site + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">return</span> chr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">rChr</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line">        <span class="type">char</span> chrs[] = str.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">site</span> <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">        <span class="type">char</span> <span class="variable">chr</span> <span class="operator">=</span>  chrs[(<span class="type">int</span>) ((site + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">return</span> chr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">rCChr</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">        <span class="type">char</span> cpChrs[] = str.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">site</span> <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">        <span class="type">char</span> <span class="variable">chr</span> <span class="operator">=</span> cpChrs[(<span class="type">int</span>) ((site + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">return</span> chr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">rSb</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!@#$%^&amp;*()_+&quot;</span>;</span><br><span class="line">        <span class="type">char</span> sbs[] = str.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">site</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line">        <span class="type">char</span> <span class="variable">chr</span> <span class="operator">=</span> sbs[(<span class="type">int</span>) ((site + <span class="number">1</span>) * Math.random())];</span><br><span class="line">        <span class="keyword">return</span> chr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2023/01/17/%E8%A5%BF%E7%93%9C%E4%B9%A6D1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/17/%E8%A5%BF%E7%93%9C%E4%B9%A6D1/" class="post-title-link" itemprop="url">西瓜书D1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-01-17 22:13:04 / Modified: 23:36:15" itemprop="dateCreated datePublished" datetime="2023-01-17T22:13:04+08:00">2023-01-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="样本-（sample）-x2F-示例-instance）："><a href="#样本-（sample）-x2F-示例-instance）：" class="headerlink" title="样本 （sample）&#x2F;示例  (instance）："></a>样本 （sample）&#x2F;示例  (instance）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">关于某一事件或对象的一条描述。</span><br><span class="line">xi = (xi1, xi2,...xid)</span><br><span class="line"></span><br><span class="line">例如，</span><br><span class="line"></span><br><span class="line">(色泽=青绿;根蒂=蜷缩;敲声=浊响)，</span><br><span class="line"></span><br><span class="line">(色泽=乌黑;根蒂=稍蜷;敲声=沉闷)，</span><br><span class="line"></span><br><span class="line">(色泽=浅白;根蒂=硬挺;敲声=清脆)，</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h5 id="属性-attribute-x2F-特征-（feature）："><a href="#属性-attribute-x2F-特征-（feature）：" class="headerlink" title="属性 (attribute)&#x2F;特征 （feature）："></a>属性 (attribute)&#x2F;特征 （feature）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事件或对象某方面的表现，如上例中的“色泽”，“根蒂”，“敲声”</span><br></pre></td></tr></table></figure>

<h5 id="属性值（attribute-value）："><a href="#属性值（attribute-value）：" class="headerlink" title="属性值（attribute value）："></a>属性值（attribute value）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">“青绿”，“蜷缩”，“浊响”</span><br><span class="line">xi1, xi2,...xid</span><br></pre></td></tr></table></figure>

<h5 id="样本空间-sample-space-x2F-属性空间-attribute-space）："><a href="#样本空间-sample-space-x2F-属性空间-attribute-space）：" class="headerlink" title="样本空间 (sample space)&#x2F;属性空间 (attribute space）："></a>样本空间 (sample space)&#x2F;属性空间 (attribute space）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">所有样本组（sample）成的空间。</span><br><span class="line">D =  &#123;x1, x2,....,xn&#125;</span><br></pre></td></tr></table></figure>

<h5 id="特征向量（feature-vector）："><a href="#特征向量（feature-vector）：" class="headerlink" title="特征向量（feature vector）："></a>特征向量（feature vector）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性（attribute）组成的向量。</span><br><span class="line">xi = (xi1, xi2,...xid)</span><br></pre></td></tr></table></figure>

<h5 id="假设（hypothesis）："><a href="#假设（hypothesis）：" class="headerlink" title="假设（hypothesis）："></a>假设（hypothesis）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">每个属性取值的一种组合为一种假设。训练就是从就是从所有组合中找为“真”的组合。</span><br><span class="line">如，(色泽=青绿;根蒂=蜷缩;敲声=浊响)，“真”。</span><br></pre></td></tr></table></figure>

<h5 id="假设空间（hypothesis-space）："><a href="#假设空间（hypothesis-space）：" class="headerlink" title="假设空间（hypothesis space）："></a>假设空间（hypothesis space）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每个属性的各种组合组成的空间</span><br><span class="line"></span><br><span class="line">如，4 × 3 × 3 + 1 = 37</span><br></pre></td></tr></table></figure>

<h5 id="版本空间（version-space）："><a href="#版本空间（version-space）：" class="headerlink" title="版本空间（version space）："></a>版本空间（version space）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设空间中，如果存在与训练集一致的“假设合集”，成为版本空间。</span><br></pre></td></tr></table></figure>



<h5 id="真相-x2F-真-实（ground-truth）："><a href="#真相-x2F-真-实（ground-truth）：" class="headerlink" title="真相&#x2F;真 实（ground-truth）："></a>真相&#x2F;真 实（ground-truth）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上述潜在规律自身。</span><br></pre></td></tr></table></figure>

<h5 id="标记（label）："><a href="#标记（label）：" class="headerlink" title="标记（label）："></a>标记（label）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（(色泽=青绿;根蒂=蜷缩;敲声=浊响)，好瓜），这里的“好瓜”就是标记。</span><br></pre></td></tr></table></figure>

<h5 id="样例（example）："><a href="#样例（example）：" class="headerlink" title="样例（example）："></a>样例（example）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">拥有了标记的样本，(xi，yi)表示第i个样例</span><br><span class="line"></span><br><span class="line">如（(色泽=青绿;根蒂=蜷缩;敲声=浊响)，好瓜）</span><br></pre></td></tr></table></figure>

<h5 id="标记空间（label-space）："><a href="#标记空间（label-space）：" class="headerlink" title="标记空间（label space）："></a>标记空间（label space）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yi ∈ Y</span><br></pre></td></tr></table></figure>



<h5 id="分类（classification）："><a href="#分类（classification）：" class="headerlink" title="分类（classification）："></a>分类（classification）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果预测结果是离散值，则为分类。</span><br></pre></td></tr></table></figure>

<h5 id="回归（regression）："><a href="#回归（regression）：" class="headerlink" title="回归（regression）："></a>回归（regression）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果预测的结果为连续值，则为回归。</span><br><span class="line">例如西瓜成熟度0.95、0.37。</span><br></pre></td></tr></table></figure>

<h5 id="聚类（clustering）："><a href="#聚类（clustering）：" class="headerlink" title="聚类（clustering）："></a>聚类（clustering）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将训练集中的样本分组。每一组为一个“簇“（clster）。</span><br><span class="line"></span><br><span class="line">如，“浅色瓜” ，“深色瓜”，“本地瓜”， “外地瓜”等。</span><br></pre></td></tr></table></figure>

<h5 id="归纳（induction）："><a href="#归纳（induction）：" class="headerlink" title="归纳（induction）："></a>归纳（induction）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从特殊到一般，从具体事实归纳出一般规律。</span><br></pre></td></tr></table></figure>

<h5 id="演绎（deduction）："><a href="#演绎（deduction）：" class="headerlink" title="演绎（deduction）："></a>演绎（deduction）：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从一般到特殊，从基础原理推出具体状况。</span><br></pre></td></tr></table></figure>



<h5 id="训练样本（training-sample）"><a href="#训练样本（training-sample）" class="headerlink" title="训练样本（training sample）"></a>训练样本（training sample）</h5><h5 id="训练集（training-set）"><a href="#训练集（training-set）" class="headerlink" title="训练集（training set）"></a>训练集（training set）</h5><h5 id="测试样本（testing-sample）"><a href="#测试样本（testing-sample）" class="headerlink" title="测试样本（testing sample）"></a>测试样本（testing sample）</h5><h5 id="测试集（testing-set）"><a href="#测试集（testing-set）" class="headerlink" title="测试集（testing set）"></a>测试集（testing set）</h5><h5 id="监督学习（supervised-learning）"><a href="#监督学习（supervised-learning）" class="headerlink" title="监督学习（supervised learning）"></a>监督学习（supervised learning）</h5><h5 id="无监督学习（unsupervised-learning）"><a href="#无监督学习（unsupervised-learning）" class="headerlink" title="无监督学习（unsupervised learning）"></a>无监督学习（unsupervised learning）</h5><h5 id="泛化（generalization）"><a href="#泛化（generalization）" class="headerlink" title="泛化（generalization）"></a>泛化（generalization）</h5>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2022/11/05/About-Zero-Clear/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/05/About-Zero-Clear/" class="post-title-link" itemprop="url">About Zero Clear</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-11-05 00:36:02 / Modified: 00:43:02" itemprop="dateCreated datePublished" datetime="2022-11-05T00:36:02+08:00">2022-11-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>清零也好，放开也好，都不重要。对于个例（个人、公司、或者一个团体）而言，问题只有多少没有大小。初中生一组二元一次方程解决的问题，小学生要用繁琐的加减乘除来回倒；一个行政审批，对于审批者，可能是今天用哪只笔签字，对于申请者，可能就是无数张讨生活的嘴；食客在考虑吃什么鱼，鱼缸里就是接下来哪条会死。</p>
<p>时代的一粒沙，落在谁身上都是一座山。在动态清零的大环境下，每一个个例面其实都有自己具体的问题。封门、拒医、拒载、歧视、物资短缺、安全码异常、粗暴隔离、入户消杀等，这些有多少是一把手亲自指挥亲自部署的？有多少是中央或者部委一级明确或者默许的？有多少不知道是谁自己高兴或是不管不顾就实现了？还有些事情，上边不但没默许，甚至是不满意，但是也没处分人，这是为什么？这种情况算谁的责任？</p>
<p>封城的时候，保供人员可以出门。谁是保供人员？有人是开饭店的，这个月是，下个月就不是了；同样品牌的连锁店，有的是，有的不是；同一份证明，在一个社区可以出门，他同事在另一个社区出不去。有的家里有食物储备，关个十天半月没问题。有的人天天网上抢菜。有人在家不出门，天天有人送菜。有的社区断不了有卖菜的。有的社区连外卖送到门口都不行。谁和谁的情况都不一样。</p>
<p>讲到个人，工作效率下降，这和居家办公有多少关系，有多少没有关系？讲到餐饮行业，客流量、销售额下降，有多少和封控有直接关系，有多少和经济形势有关系，还有多少和自己经营有关系？有成片关门的饭店，有苦苦支撑的门面，同时还有几乎天天排队到营业结束的餐厅。再从餐饮延伸到各个行业，营业额下降、订单量下降、利润下降等，这些有多少受“清零”影响，多少是“疫情”影响，多少是经济环境影响，多少是行业影响，多少是业务问题？</p>
<p>多年CRM经历，总结了条经验，那些特别挑战人三观的问题，几乎不可能是有人故意为之。疑难杂症一般都是制度缺失，在时间的积累上造成的。有小问题在夹缝里，来回推脱，来回挤压，慢慢就成长了。在其中还可能有几个关键节点，每个节点如果错误处理一次，还会造成问题“变异”。就这样，小问题最后变成什么样都可能了。地主给傻儿子买了只小鸡玩。傻儿子一脚就给踩成肉泥了。地主帮孩子擦擦脚，领着回家吃饭去了。 </p>
<p>最后谈下对比。经济环境可以拿过去五到十年和过去三年对比下。单纯说疫情，非典可以对比。虽然非典时间短、传染力弱，但是致病力比现在高得多，它对于社会心理层面影响应该不比现在小。持续时间，和初期表现，03年的广州和20年的武汉应该可以比一下。后期扩散开，非典时期全国的表现和现在全国表现，也可以参考下。当年也有封楼、封小区，当年的互联网没有现在发达，当年的物业、居委会、街道是个什么状态，现在是什么状态？当年也有停课、停工，当年大家是什么样的生活状态，是什么样的心态，现在是什么样？</p>
<p>这是个非常开放性问题。这里有个人，有身边人，有社会；有和“清零”有关，也可能没关系；有疫情有关，也可能没关系；有过去这些年改变了的，也有一直没有变，只是被忽视了。每个人都应该从自己的角度，回望过去的三年或是更久，找到自己的答案。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2022/11/01/DC3-Algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/01/DC3-Algorithm/" class="post-title-link" itemprop="url">DC3 Algorithm</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-11-01 00:31:13 / Modified: 00:36:11" itemprop="dateCreated datePublished" datetime="2022-11-01T00:31:13+08:00">2022-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DC3</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sa;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] rank;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] h;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] heightEg;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  DC3 Algorithm or Skew，generates three structures：</span></span><br><span class="line"><span class="comment">	 *  sa[]，suffix array of sorted suffixes, sa[i] = &#123;pos of nums[]&#125;.</span></span><br><span class="line"><span class="comment">	 *  rank[]，rank[i] is rank of nums[], i is pos of nums[].</span></span><br><span class="line"><span class="comment">	 *  height[]，height[i] is length of the longest common prefix between sa[i - 1] and sa[i].</span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     * h[] help to generate height[], h[i] is length and h[i] &gt;= h[i - 1] - 1.</span></span><br><span class="line"><span class="comment">     * i is pos of nums[].</span></span><br><span class="line"><span class="comment">	   * <span class="doctag">@param</span> nums origin array/ input array. </span></span><br><span class="line"><span class="comment">     * String should be converted to an integer array.</span></span><br><span class="line"><span class="comment">     * The min value of array should &gt;= 1.</span></span><br><span class="line"><span class="comment">     * A main() function is given for an example in the tail.</span></span><br><span class="line"><span class="comment">	   * <span class="doctag">@param</span> max the max value of nums</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DC3</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        sa = sa(nums, max);</span><br><span class="line">        rank = rank();</span><br><span class="line">        height = height(nums);</span><br><span class="line"></span><br><span class="line">        h = h(nums);</span><br><span class="line">        heightEg = heightEg(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] sa(<span class="type">int</span>[] nums, <span class="type">int</span> max) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[len + <span class="number">3</span>]; <span class="comment">// triple s[i, i + 2]</span></span><br><span class="line">        <span class="comment">// +3 Si = s[i,n)◦[0],Si = s[i,n)◦[0,0] ?</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            arr[i] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> skew(arr, len, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] skew(<span class="type">int</span>[] nums, <span class="type">int</span> len, <span class="type">int</span> max) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">		 *  mississippi</span></span><br><span class="line"><span class="comment">		 * nums = &#123;m, i, s, s, i, s, s, i, p, p, i&#125;</span></span><br><span class="line"><span class="comment">		 *         0  1  2  3  4  5  6  7  8  9  10</span></span><br><span class="line"><span class="comment">		 * n0 = 4, n1 = 4, n2 = 3, n02 = 7</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n0</span> <span class="operator">=</span> (len + <span class="number">2</span>) / <span class="number">3</span>, n1 = (len + <span class="number">1</span>) / <span class="number">3</span>, n2 = (len + <span class="number">0</span>) / <span class="number">3</span>, n02 = n0 + n2;</span><br><span class="line">        <span class="type">int</span>[] s12 = <span class="keyword">new</span> <span class="title class_">int</span>[n02 + <span class="number">3</span>], sa12 =  <span class="keyword">new</span> <span class="title class_">int</span>[n02 + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; len + (n0 - n1); i++) &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             *  To generate s0 using sa12</span></span><br><span class="line"><span class="comment">             * (n0 - n1) : if s0.length != s1.length, len + 1</span></span><br><span class="line"><span class="comment">             * for (int i = 0, j = 0; i &lt; n02; i++) &#123;</span></span><br><span class="line"><span class="comment">             *   if (sa12[i] &lt; n0) &#123;</span></span><br><span class="line"><span class="comment">             *     s0[j++] = 3 * sa12[i];</span></span><br><span class="line"><span class="comment">             *    &#125;</span></span><br><span class="line"><span class="comment">             * &#125;</span></span><br><span class="line"><span class="comment">             *  s12[len + 1 - 1] will be first after radixPass.</span></span><br><span class="line"><span class="comment">             *  Generating of s0 need s12[len + 1 - 1].</span></span><br><span class="line"><span class="comment">             */</span> </span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> != i % <span class="number">3</span>) &#123;</span><br><span class="line">                s12[j++] = i; </span><br><span class="line">                <span class="comment">/* </span></span><br><span class="line"><span class="comment">                 * s12[i] is pos of nums[]</span></span><br><span class="line"><span class="comment">                 * s12[i] = &#123;1, 2, 4, 5,..., 0, 0, 0&#125;</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nums: values; s12/sa12: pos</span></span><br><span class="line">        radixPass(nums, s12, sa12, <span class="number">2</span>, n02, max);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * s12[i] + 2;</span></span><br><span class="line"><span class="comment">		 * is[s], ss[i], is[s], ss[i], ip[p], pp[i],  i&quot;0&quot;[&quot;0&quot;]</span></span><br><span class="line"><span class="comment">		 * 12[3], 23[4], 45[6], 56[7], 78[9], 89[10], 10&quot;0&quot;[&quot;0&quot;]</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		radixPass(nums, sa12, s12, <span class="number">1</span>, n02, max);</span><br><span class="line">		radixPass(nums, s12, sa12, <span class="number">0</span>, n02, max);</span><br><span class="line">        <span class="comment">// nums: values, s12/sa12: pos</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">0</span>, c0 = -<span class="number">1</span>, c1 = -<span class="number">1</span>, c2 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n02; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!(c0 == nums[sa12[i]] &amp;&amp; c1 == nums[sa12[i] + <span class="number">1</span>] &amp;&amp; c2 == nums[sa12[i] + <span class="number">2</span>])) &#123;</span><br><span class="line">                <span class="comment">// same sa12[i, i + 2] has same name</span></span><br><span class="line">                name++;</span><br><span class="line">                c0 = nums[sa12[i]];</span><br><span class="line">                c1 = nums[sa12[i] + <span class="number">1</span>];</span><br><span class="line">                c2 = nums[sa12[i] + <span class="number">2</span>];</span><br><span class="line">            &#125;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * set names of s12, s12 well be rewrited </span></span><br><span class="line"><span class="comment">			 * s12 = s1[0, 1, 2 .. n0 - 1] + s2[n0, n0 + 1...] , nums(1, 4, 7... | 2, 5, 8...)</span></span><br><span class="line"><span class="comment">			 * s12[] names of suffixes, i is </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> == sa12[i] % <span class="number">3</span>) &#123;</span><br><span class="line">                s12[sa12[i] / <span class="number">3</span>] = name;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                s12[sa12[i] / <span class="number">3</span> + n0] = name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nums: valus; s12: ranks of s1(pos 1,4,7,.. of nums) + s2; sa12: sa12[0,i] = &#123;pos of nums&#125;, sorted suffix array</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (name &lt; n02) &#123;</span><br><span class="line">            sa12 = skew(s12, n02, name);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n02; i++) &#123;</span><br><span class="line">                s12[sa12[i]] = i + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n02; i++) &#123;</span><br><span class="line">                sa12[s12[i] - <span class="number">1</span>] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// nums: valus; s12: ranks of s1(pos 1,4,7,.. of nums) + s2; sa12:  pos of s12</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] s0 = <span class="keyword">new</span> <span class="title class_">int</span>[n0], sa0 = <span class="keyword">new</span> <span class="title class_">int</span>[n0];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * To generate s0 using sa12</span></span><br><span class="line"><span class="comment">		 * sa12:  pos of s12 (s1 + s2)</span></span><br><span class="line"><span class="comment">		 * sa12  =   &#123;3, 2, 1, 0, | 6, 5, 4,&#125;</span></span><br><span class="line"><span class="comment">		 *            0  1  2  3  | 4  5  6   </span></span><br><span class="line"><span class="comment">		 * s12          s1 &lt; n0   |   s2</span></span><br><span class="line"><span class="comment">		 * nums       10 7  4  1  | 8  5  2</span></span><br><span class="line"><span class="comment">		 *                s1 &lt; n0 |    s2</span></span><br><span class="line"><span class="comment">		 * s0    =   &#123;m, s, s, p&#125; </span></span><br><span class="line"><span class="comment">		 * nums       0  3  6  9</span></span><br><span class="line"><span class="comment">		 * 3*sa12[i]: p(9), s(6), s(3), m(0)</span></span><br><span class="line"><span class="comment">		 * nums       9 10  6 7   3 4   0 1</span></span><br><span class="line"><span class="comment">		 * run the last time radixPass </span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; n02; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sa12[i] &lt; n0) &#123;</span><br><span class="line">                s0[j++] = <span class="number">3</span> * sa12[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        radixPass(nums, s0, sa0, <span class="number">0</span>, n0, max);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] sa = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">     * merge</span></span><br><span class="line"><span class="comment">		 * p: sa0[p]</span></span><br><span class="line"><span class="comment">		 * t: sa12[t]</span></span><br><span class="line"><span class="comment">		 * k: sa[k]</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>, t = n0 - n1, k = <span class="number">0</span>; k &lt; len; k++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> sa12[t] &lt; n0 ? sa12[t] * <span class="number">3</span> + <span class="number">1</span> : (sa12[t] - n0) * <span class="number">3</span> + <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> sa0[p];</span><br><span class="line">			<span class="keyword">if</span> (sa12[t] &lt; n0 ? </span><br><span class="line">			    leq(nums[i], s12[sa12[t] + n0], nums[j], s12[j / <span class="number">3</span>])</span><br><span class="line">				    : leq(nums[i], nums[i + <span class="number">1</span>], s12[sa12[t] - n0 + <span class="number">1</span>], nums[j], nums[j + <span class="number">1</span>], s12[j / <span class="number">3</span> + n0])) </span><br><span class="line">			&#123; <span class="comment">// suffix from SA12 is smaller</span></span><br><span class="line">				sa[k] = i;</span><br><span class="line">				t++;</span><br><span class="line">				<span class="keyword">if</span> (t == n02) &#123; <span class="comment">// done --- only SA0 suffixes left</span></span><br><span class="line">					<span class="keyword">for</span> (k++; p &lt; n0; p++, k++) &#123;</span><br><span class="line">						sa[k] = sa0[p];</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123; <span class="comment">// suffix from SA0 is smaller</span></span><br><span class="line">				sa[k] = j;</span><br><span class="line">				p++;</span><br><span class="line">				<span class="keyword">if</span> (p == n0) &#123; <span class="comment">// done --- only SA12 suffixes left</span></span><br><span class="line">					<span class="keyword">for</span> (k++; t &lt; n02; t++, k++) &#123;</span><br><span class="line">						sa[k] = sa12[t] &lt; n0 ? sa12[t] * <span class="number">3</span> + <span class="number">1</span> : (sa12[t] - n0) * <span class="number">3</span> + <span class="number">2</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">return</span> sa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> nums origin Array</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> input s12 Array</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> output sorted s12 array</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> offset the pos after s12[i], triple s[i, i + offset]</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> len none zore length of input. Si =s[i,n)◦[0,0]</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> max of nums</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">radixPass</span> <span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span>[] input, <span class="type">int</span>[] output, <span class="type">int</span> offset, <span class="type">int</span> len, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[max + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i)&#123;</span><br><span class="line">            cnt[nums[input[i] + offset]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; cnt.length; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> cnt[i];</span><br><span class="line">            cnt[i] = sum;</span><br><span class="line">            sum += t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            output[cnt[nums[input[i] + offset]]++] = input[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">leq</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> b1, <span class="type">int</span> b2)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a1 &lt; b1 || (a1 == b1 &amp;&amp; a2 &lt;= b2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">leq</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> b1, <span class="type">int</span> b2, <span class="type">int</span> b3)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a1 &lt; b1 || (a1 == b1 &amp;&amp; leq(a2, a3, b2, b3));</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span>[] rank() &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> sa.length;</span><br><span class="line">		<span class="type">int</span>[] s = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">			s[sa[i]] = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> s;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] height(<span class="type">int</span>[] s) &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line">		<span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, k = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (rank[i] != <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					--k;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> sa[rank[i] - <span class="number">1</span>];</span><br><span class="line">				<span class="keyword">while</span> (i + k &lt; n &amp;&amp; j + k &lt; n &amp;&amp; s[i + k] == s[j + k]) &#123;</span><br><span class="line">					++k;</span><br><span class="line">				&#125;</span><br><span class="line">				ans[rank[i]] = k;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] heightEg(<span class="type">int</span>[] h)&#123;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[h.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; h.length; i++) &#123;</span><br><span class="line">            ans[i] = h[sa[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] h(<span class="type">int</span>[] s) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, k = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rank[i] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// h[i - 1] - 1 &lt;= h[i]</span></span><br><span class="line">                    --k;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">pre</span> <span class="operator">=</span> sa[rank[i] - <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">while</span> (i + k &lt; n &amp;&amp; pre + k &lt; n &amp;&amp; s[i + k] == s[pre + k] ) &#123;</span><br><span class="line">                    k++;</span><br><span class="line">                &#125;</span><br><span class="line">                ans[i] = k;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// for testing</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] randomArray(<span class="type">int</span> len, <span class="type">int</span> maxValue) &#123;</span><br><span class="line">		<span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">			arr[i] = (<span class="type">int</span>) (Math.random() * maxValue) + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> arr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSameArray</span><span class="params">(<span class="type">int</span>[] arr1, <span class="type">int</span>[] arr2)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (arr1.length != arr2.length) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> arr1.length;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (arr1[i] != arr2[i]) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// for testing</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// one time test</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;mississippi&quot;</span>;</span><br><span class="line">        <span class="comment">// String s = &quot;aabaabb&quot;;</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">char</span>[] str = s.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> cha : str) &#123;</span><br><span class="line">             min = Math.min(min, cha);</span><br><span class="line">            max = Math.max(max, cha);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">            arr[j] = str[j] - min + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">        <span class="type">DC3</span> <span class="variable">dc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DC3</span>(arr, max - min + <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;sa: &quot;</span> + Arrays.toString(dc.sa));</span><br><span class="line">        System.out.println(<span class="string">&quot;rank: &quot;</span> + Arrays.toString(dc.rank));</span><br><span class="line">        System.out.println(<span class="string">&quot;height: &quot;</span> + Arrays.toString(dc.height));</span><br><span class="line">        System.out.println(<span class="string">&quot;h: &quot;</span> + Arrays.toString(dc.h));</span><br><span class="line">        System.out.println(<span class="string">&quot;heightEg: &quot;</span> + Arrays.toString(dc.heightEg));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// int len = 1000;</span></span><br><span class="line">		<span class="comment">// int maxValue = 100;</span></span><br><span class="line">        <span class="comment">// int times = 1000000;</span></span><br><span class="line">        <span class="comment">// System.out.println(&quot;test start!&quot;);</span></span><br><span class="line">        <span class="comment">// for (int i = 0; i &lt; times; i++) &#123;</span></span><br><span class="line">        <span class="comment">//     DC3 dc = new DC3(randomArray(len, maxValue), maxValue);</span></span><br><span class="line">        <span class="comment">//     int[] ans1 = dc.height;</span></span><br><span class="line">        <span class="comment">//     int[] ans2 = dc.heightEg;</span></span><br><span class="line">        <span class="comment">//     if (!isSameArray(ans1, ans2)) &#123;</span></span><br><span class="line">        <span class="comment">//         System.out.println(&quot;test &quot; + i +&quot; fail!&quot; + &quot;ans1s len :&quot; + ans1.length);</span></span><br><span class="line">        <span class="comment">//         System.out.println(&quot;ans1: &quot; + Arrays.toString(ans1));</span></span><br><span class="line">        <span class="comment">//         System.out.println(&quot;ans2: &quot; + Arrays.toString(ans2));</span></span><br><span class="line">        <span class="comment">//     &#125; </span></span><br><span class="line">        <span class="comment">//     // else &#123;</span></span><br><span class="line">        <span class="comment">//     //     System.out.println(&quot;test &quot; + i +&quot; pass!&quot; + &quot;ans1s len :&quot; + ans1.length);</span></span><br><span class="line">        <span class="comment">//     //     System.out.println(&quot;ans1: &quot; + Arrays.toString(ans1));</span></span><br><span class="line">        <span class="comment">//     //     System.out.println(&quot;ans2: &quot; + Arrays.toString(ans2));</span></span><br><span class="line">        <span class="comment">//     // &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// System.out.println(&quot;test finish!&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2022/06/24/Fact-or-Opinion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/24/Fact-or-Opinion/" class="post-title-link" itemprop="url">Fact or Opinion</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-06-24 09:37:58 / Modified: 09:43:45" itemprop="dateCreated datePublished" datetime="2022-06-24T09:37:58+08:00">2022-06-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Reading is mainly about extracting information; it is about constructing knowledge, thinking critically and making well-founded judgements.</p>
<p>You can take a quiz about “Fact or Opinion”  <a target="_blank" rel="noopener" href="https://www.pewresearch.org/quiz/news-statements-quiz/">here</a>.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2022/06/20/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%85%88%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/20/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%85%88%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" class="post-title-link" itemprop="url">二叉树先序遍历序列化、反序列化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-20 22:41:47" itemprop="dateCreated datePublished" datetime="2022-06-20T22:41:47+08:00">2022-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-01 00:39:42" itemprop="dateModified" datetime="2022-11-01T00:39:42+08:00">2022-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉树先序遍历序列化、反序列化</span></span><br><span class="line"><span class="comment"> * 递归方法、非递归方法、对数器验证</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">serializeAndRecontructTreeSpoon</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="type">int</span> value;</span><br><span class="line">		<span class="keyword">public</span> Node left;</span><br><span class="line">		<span class="keyword">public</span> Node right;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.value = data;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">NodeNull</span> &#123;</span><br><span class="line">		<span class="keyword">public</span> Node value;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">NodeNull</span><span class="params">(Node data)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.value = data;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 递归序列化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;String&gt; <span class="title function_">preSerial</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">        Queue&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        pres(head, ans);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">pres</span><span class="params">(Node head, Queue&lt;String&gt; ans)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">			ans.add(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ans.add(String.valueOf(head.value));</span><br><span class="line">			pres(head.left, ans);</span><br><span class="line">			pres(head.right, ans);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非递归序列化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;String&gt; <span class="title function_">preSerialUR</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">        Queue&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        presUR(head, ans);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">presUR</span><span class="params">(Node head,  Queue&lt;String&gt; ans)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(head == <span class="literal">null</span>) &#123;</span><br><span class="line">			ans.add(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Stack&lt;NodeNull&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">		<span class="type">NodeNull</span> <span class="variable">headNull</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NodeNull</span>(head);</span><br><span class="line">		stack.push(headNull);</span><br><span class="line">		<span class="keyword">while</span>(!stack.isEmpty()) &#123;</span><br><span class="line">			<span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> stack.pop().value;</span><br><span class="line">			<span class="keyword">if</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">				ans.add(String.valueOf(cur.value));</span><br><span class="line">                <span class="type">NodeNull</span> <span class="variable">curNull</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NodeNull</span>(cur.right);</span><br><span class="line">                stack.add(curNull);</span><br><span class="line">                curNull = <span class="keyword">new</span> <span class="title class_">NodeNull</span>(cur.left);</span><br><span class="line">                stack.add(curNull);</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">if</span> (cur == <span class="literal">null</span>) &#123;</span><br><span class="line">				ans.add(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 递归反序列化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title function_">buildByPreQueue</span><span class="params">(Queue&lt;String&gt; prelist)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (prelist == <span class="literal">null</span> ||prelist.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> preB(prelist);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title function_">preB</span><span class="params">(Queue&lt;String&gt; prelist)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> prelist.poll();</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="string">&quot;#&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.valueOf(value));</span><br><span class="line">        head.left = preB(prelist);</span><br><span class="line">        head.right = preB(prelist);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非递归反序列化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title function_">buildByPreQueueUR</span><span class="params">(Queue&lt;String&gt; prelist)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (prelist == <span class="literal">null</span> ||prelist.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> preBUR(prelist);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title function_">preBUR</span><span class="params">(Queue&lt;String&gt; prelist)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> prelist.poll();</span><br><span class="line">		<span class="keyword">if</span> (value == <span class="string">&quot;#&quot;</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.valueOf(value));</span><br><span class="line">		<span class="type">Node</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">		Stack&lt;Node&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">		stack.push(cur);</span><br><span class="line">		<span class="keyword">while</span> (prelist.size() &gt; <span class="number">2</span>) &#123; <span class="comment">// 最后两个“#”不处理</span></span><br><span class="line">			value = prelist.poll();</span><br><span class="line">			<span class="keyword">if</span> (value != <span class="string">&quot;#&quot;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!stack.isEmpty() &amp;&amp; cur == stack.peek()) &#123;</span><br><span class="line">					cur.left = <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.valueOf(value));</span><br><span class="line">					cur = cur.left;</span><br><span class="line">					stack.push(cur);</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					cur.right = <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.valueOf(value));</span><br><span class="line">					cur = cur.right;</span><br><span class="line">					stack.push(cur);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// if (!stack.isEmpty()) &#123; </span></span><br><span class="line">                <span class="comment">// 防止最后一个“#”越界</span></span><br><span class="line">				cur = stack.pop();</span><br><span class="line">				<span class="comment">// &#125;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> head;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================for test======================</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title function_">generateRandomBST</span><span class="params">(<span class="type">int</span> maxLevel, <span class="type">int</span> maxValue)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">curLevel</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> generate(curLevel, maxLevel, maxValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title function_">generate</span><span class="params">(<span class="type">int</span> curLevel, <span class="type">int</span> maxLevel, <span class="type">int</span> maxValue)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (curLevel &gt; maxLevel || Math.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>((<span class="type">int</span>) (Math.random() * maxValue));</span><br><span class="line">        head.left = generate(curLevel + <span class="number">1</span>, maxLevel, maxValue);</span><br><span class="line">        head.right = generate(curLevel + <span class="number">1</span>, maxLevel, maxValue);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isSameValueStructure</span><span class="params">(Node head1, Node head2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head1 == <span class="literal">null</span> &amp;&amp; head2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head1 == <span class="literal">null</span> &amp;&amp; head2 != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head1 != <span class="literal">null</span> &amp;&amp; head2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head1.value !=  head2.value) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSameValueStructure(head1.left, head1.left) &amp;&amp; isSameValueStructure(head1.right, head1.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLevel</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxValue</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;=======test begin!=======&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; testTimes; i++) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> generateRandomBST(maxLevel, maxValue);</span><br><span class="line">            Queue&lt;String&gt; pre = preSerial(head);</span><br><span class="line">            Queue&lt;String&gt; preUR = preSerialUR(head);</span><br><span class="line">            <span class="type">Node</span> <span class="variable">preBuild</span> <span class="operator">=</span> buildByPreQueue(pre);</span><br><span class="line">            <span class="type">Node</span> <span class="variable">preBuildUR</span> <span class="operator">=</span> buildByPreQueueUR(preUR);</span><br><span class="line">            <span class="keyword">if</span> (!isSameValueStructure(preBuild, preBuildUR)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;fall!!!!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;=======test finish!=======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://acorngyl.github.io/2022/06/17/0%E3%80%811%E7%AD%89%E6%A6%82%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Acorn G">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="spoonCat">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | spoonCat">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/17/0%E3%80%811%E7%AD%89%E6%A6%82%E7%8E%87/" class="post-title-link" itemprop="url">0、1等概率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-17 22:14:40" itemprop="dateCreated datePublished" datetime="2022-06-17T22:14:40+08:00">2022-06-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-01 00:39:06" itemprop="dateModified" datetime="2022-11-01T00:39:06+08:00">2022-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Random01Spoon</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 01不等概率获得01等概率</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 模拟0、1不等概率</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">randNone</span><span class="params">(<span class="type">double</span> p)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.random() &lt; p ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0、1等概率</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">randomEq</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">first</span> <span class="operator">=</span> randNone(<span class="number">0.3</span>);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            first = randNone(<span class="number">0.3</span>);</span><br><span class="line">        &#125; <span class="keyword">while</span> (first == randNone(<span class="number">0.3</span>)); <span class="comment">// 00或11继续循环，出现01或10的概率相等</span></span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  1～5等概率获得1～7等概率</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1～5等概率</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">random04</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (Math.random() * <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0、1等概率</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">random01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            m = random04();</span><br><span class="line">        &#125; <span class="keyword">while</span> (m == <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> m &lt; <span class="number">3</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1～7等概率</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">random06</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            m = (random01() &lt;&lt; <span class="number">2</span>) + (random01() &lt;&lt; <span class="number">1</span>) + random01();</span><br><span class="line">        &#125; <span class="keyword">while</span> (m == <span class="number">7</span>);</span><br><span class="line">        <span class="keyword">return</span> m + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span>[] r01s = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">       <span class="type">int</span> <span class="variable">times</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (; i &lt; times; i++) &#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">r01</span> <span class="operator">=</span> randNone(<span class="number">0.3</span>);</span><br><span class="line">           r01s[r01]++;</span><br><span class="line">       &#125;       </span><br><span class="line">       System.out.println(<span class="string">&quot;====01不等概率===========&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;0 : &quot;</span> + (<span class="type">double</span>)r01s[<span class="number">0</span>] / (<span class="type">double</span>)times + <span class="string">&quot;, 1 : &quot;</span> + (<span class="type">double</span>)r01s[<span class="number">1</span>] / (<span class="type">double</span>)times);</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span>[] r01es = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">       <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; times; i++) &#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">r01e</span> <span class="operator">=</span> randomEq();</span><br><span class="line">           r01es[r01e]++;</span><br><span class="line">       &#125;       </span><br><span class="line">       System.out.println(<span class="string">&quot;====01等概率===========&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;0 : &quot;</span> + (<span class="type">double</span>)r01es[<span class="number">0</span>] / (<span class="type">double</span>)times + <span class="string">&quot;, 1 : &quot;</span> + (<span class="type">double</span>)r01es[<span class="number">1</span>] / times);</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">&quot;====1～7等概率===========&quot;</span>);</span><br><span class="line">       <span class="type">int</span>[] r07s = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">8</span>];</span><br><span class="line">       <span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt; times; i++) &#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">r07</span> <span class="operator">=</span> random06();</span><br><span class="line">           r07s[r07]++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; r07s.length; j++) &#123;</span><br><span class="line">           System.out.println(j + <span class="string">&quot; : &quot;</span> + (<span class="type">double</span>)r07s[j] / (<span class="type">double</span>)times);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Acorn G</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
